<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Sample D3</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
    <script src="main.js"></script>
</head>
<body>

    <h1>Simple D3.js</h1>
    <script>
    var data = {"results":[{"columns":["a","r","b"],"data":[{"graph":{"nodes":[{"id":"272","labels":["EMAIL"],"properties":{"name":"EMAIL","document_id":"RITM100123"}},{"id":"273","labels":["Topic tags"],"properties":{"name":"topic_tag: Topic 1:  account_invoic"}}],"relationships":[{"id":"245","type":"CONTAINS","startNode":"272","endNode":"273","properties":{}}]}},{"graph":{"nodes":[{"id":"272","labels":["EMAIL"],"properties":{"name":"EMAIL","document_id":"RITM100123"}},{"id":"273","labels":["Topic tags"],"properties":{"name":"topic_tag: Topic 1:  account_invoic"}},{"id":"274","labels":["Confidence Score"],"properties":{"name":"confidence_score: 41.744"}}],"relationships":[{"id":"245","type":"CONTAINS","startNode":"272","endNode":"273","properties":{}},{"id":"246","type":"CONFIDENCE SCORE %","startNode":"273","endNode":"274","properties":{}}]}},{"graph":{"nodes":[{"id":"272","labels":["EMAIL"],"properties":{"name":"EMAIL","document_id":"RITM100123"}},{"id":"273","labels":["Topic tags"],"properties":{"name":"topic_tag: Topic 1:  account_invoic"}},{"id":"275","labels":["Sentence"],"properties":{"name":"sentence: Following on from our letter dated 2 weeks ago, invoice 35045 is still pending and I am reminding you that your account still remains overdue., ."}}],"relationships":[{"id":"245","type":"CONTAINS","startNode":"272","endNode":"273","properties":{}},{"id":"247","type":"CONTEXT","startNode":"273","endNode":"275","properties":{}}]}},{"graph":{"nodes":[{"id":"272","labels":["EMAIL"],"properties":{"name":"EMAIL","document_id":"RITM100123"}},{"id":"273","labels":["Topic tags"],"properties":{"name":"topic_tag: Topic 1:  account_invoic"}},{"id":"275","labels":["Sentence"],"properties":{"name":"sentence: Following on from our letter dated 2 weeks ago, invoice 35045 is still pending and I am reminding you that your account still remains overdue., ."}},{"id":"276","labels":["ENTITIES"],"properties":{"name":"EXTRACTED ENTITIES"}}],"relationships":[{"id":"245","type":"CONTAINS","startNode":"272","endNode":"273","properties":{}},{"id":"247","type":"CONTEXT","startNode":"273","endNode":"275","properties":{}},{"id":"248","type":"HAS","startNode":"275","endNode":"276","properties":{}}]}},{"graph":{"nodes":[{"id":"272","labels":["EMAIL"],"properties":{"name":"EMAIL","document_id":"RITM100123"}},{"id":"273","labels":["Topic tags"],"properties":{"name":"topic_tag: Topic 1:  account_invoic"}},{"id":"275","labels":["Sentence"],"properties":{"name":"sentence: Following on from our letter dated 2 weeks ago, invoice 35045 is still pending and I am reminding you that your account still remains overdue., ."}},{"id":"276","labels":["ENTITIES"],"properties":{"name":"EXTRACTED ENTITIES"}},{"id":"278","labels":["INVOICE NUMBER"],"properties":{"name":"INVOICE NUMBER"}}],"relationships":[{"id":"245","type":"CONTAINS","startNode":"272","endNode":"273","properties":{}},{"id":"247","type":"CONTEXT","startNode":"273","endNode":"275","properties":{}},{"id":"248","type":"HAS","startNode":"275","endNode":"276","properties":{}},{"id":"250","type":"CONTAINS","startNode":"276","endNode":"278","properties":{}}]}},{"graph":{"nodes":[{"id":"272","labels":["EMAIL"],"properties":{"name":"EMAIL","document_id":"RITM100123"}},{"id":"273","labels":["Topic tags"],"properties":{"name":"topic_tag: Topic 1:  account_invoic"}},{"id":"275","labels":["Sentence"],"properties":{"name":"sentence: Following on from our letter dated 2 weeks ago, invoice 35045 is still pending and I am reminding you that your account still remains overdue., ."}},{"id":"276","labels":["ENTITIES"],"properties":{"name":"EXTRACTED ENTITIES"}},{"id":"278","labels":["INVOICE NUMBER"],"properties":{"name":"INVOICE NUMBER"}},{"id":"279","labels":["InvoiceNumber"],"properties":{"name":"invoicenumber_extraction: 35045"}}],"relationships":[{"id":"245","type":"CONTAINS","startNode":"272","endNode":"273","properties":{}},{"id":"247","type":"CONTEXT","startNode":"273","endNode":"275","properties":{}},{"id":"248","type":"HAS","startNode":"275","endNode":"276","properties":{}},{"id":"250","type":"CONTAINS","startNode":"276","endNode":"278","properties":{}},{"id":"251","type":"WITH","startNode":"278","endNode":"279","properties":{}}]}},{"graph":{"nodes":[{"id":"272","labels":["EMAIL"],"properties":{"name":"EMAIL","document_id":"RITM100123"}},{"id":"273","labels":["Topic tags"],"properties":{"name":"topic_tag: Topic 1:  account_invoic"}},{"id":"275","labels":["Sentence"],"properties":{"name":"sentence: Following on from our letter dated 2 weeks ago, invoice 35045 is still pending and I am reminding you that your account still remains overdue., ."}},{"id":"276","labels":["ENTITIES"],"properties":{"name":"EXTRACTED ENTITIES"}},{"id":"278","labels":["INVOICE NUMBER"],"properties":{"name":"INVOICE NUMBER"}},{"id":"279","labels":["InvoiceNumber"],"properties":{"name":"invoicenumber_extraction: 35045"}},{"id":"280","labels":["Amount"],"properties":{"name":"amount_extraction: Amount : "}}],"relationships":[{"id":"245","type":"CONTAINS","startNode":"272","endNode":"273","properties":{}},{"id":"247","type":"CONTEXT","startNode":"273","endNode":"275","properties":{}},{"id":"248","type":"HAS","startNode":"275","endNode":"276","properties":{}},{"id":"250","type":"CONTAINS","startNode":"276","endNode":"278","properties":{}},{"id":"251","type":"WITH","startNode":"278","endNode":"279","properties":{}},{"id":"252","type":"OF","startNode":"279","endNode":"280","properties":{}}]}},{"graph":{"nodes":[{"id":"272","labels":["EMAIL"],"properties":{"name":"EMAIL","document_id":"RITM100123"}},{"id":"273","labels":["Topic tags"],"properties":{"name":"topic_tag: Topic 1:  account_invoic"}},{"id":"275","labels":["Sentence"],"properties":{"name":"sentence: Following on from our letter dated 2 weeks ago, invoice 35045 is still pending and I am reminding you that your account still remains overdue., ."}},{"id":"277","labels":["RESOLUTION"],"properties":{"name":"RESOLUTION"}}],"relationships":[{"id":"245","type":"CONTAINS","startNode":"272","endNode":"273","properties":{}},{"id":"247","type":"CONTEXT","startNode":"273","endNode":"275","properties":{}},{"id":"249","type":"CONTAINS","startNode":"275","endNode":"277","properties":{}}]}},{"graph":{"nodes":[{"id":"272","labels":["EMAIL"],"properties":{"name":"EMAIL","document_id":"RITM100123"}},{"id":"273","labels":["Topic tags"],"properties":{"name":"topic_tag: Topic 1:  account_invoic"}},{"id":"275","labels":["Sentence"],"properties":{"name":"sentence: Following on from our letter dated 2 weeks ago, invoice 35045 is still pending and I am reminding you that your account still remains overdue., ."}},{"id":"277","labels":["RESOLUTION"],"properties":{"name":"RESOLUTION"}},{"id":"281","labels":["InvoiceNumber"],"properties":{"name":"invoicenumber_extraction: Invoice Number : 35045"}}],"relationships":[{"id":"245","type":"CONTAINS","startNode":"272","endNode":"273","properties":{}},{"id":"247","type":"CONTEXT","startNode":"273","endNode":"275","properties":{}},{"id":"249","type":"CONTAINS","startNode":"275","endNode":"277","properties":{}},{"id":"253","type":"WITH","startNode":"277","endNode":"281","properties":{}}]}},{"graph":{"nodes":[{"id":"272","labels":["EMAIL"],"properties":{"name":"EMAIL","document_id":"RITM100123"}},{"id":"273","labels":["Topic tags"],"properties":{"name":"topic_tag: Topic 1:  account_invoic"}},{"id":"275","labels":["Sentence"],"properties":{"name":"sentence: Following on from our letter dated 2 weeks ago, invoice 35045 is still pending and I am reminding you that your account still remains overdue., ."}},{"id":"277","labels":["RESOLUTION"],"properties":{"name":"RESOLUTION"}},{"id":"281","labels":["InvoiceNumber"],"properties":{"name":"invoicenumber_extraction: Invoice Number : 35045"}},{"id":"282","labels":["Resolution_Status"],"properties":{"name":"resolution_status: Invoice has been paid on 03-13-2019 with payment reference # 2311960"}}],"relationships":[{"id":"245","type":"CONTAINS","startNode":"272","endNode":"273","properties":{}},{"id":"247","type":"CONTEXT","startNode":"273","endNode":"275","properties":{}},{"id":"249","type":"CONTAINS","startNode":"275","endNode":"277","properties":{}},{"id":"253","type":"WITH","startNode":"277","endNode":"281","properties":{}},{"id":"254","type":"RESOLUTION_STATUS","startNode":"281","endNode":"282","properties":{}}]}},{"graph":{"nodes":[{"id":"272","labels":["EMAIL"],"properties":{"name":"EMAIL","document_id":"RITM100123"}},{"id":"283","labels":["Topic tags"],"properties":{"name":"topic_tag: Topic 2:  payment_bank"}}],"relationships":[{"id":"255","type":"CONTAINS","startNode":"272","endNode":"283","properties":{}}]}},{"graph":{"nodes":[{"id":"272","labels":["EMAIL"],"properties":{"name":"EMAIL","document_id":"RITM100123"}},{"id":"283","labels":["Topic tags"],"properties":{"name":"topic_tag: Topic 2:  payment_bank"}},{"id":"284","labels":["Confidence Score"],"properties":{"name":"confidence_score: 58.256"}}],"relationships":[{"id":"256","type":"CONFIDENCE SCORE %","startNode":"283","endNode":"284","properties":{}},{"id":"255","type":"CONTAINS","startNode":"272","endNode":"283","properties":{}}]}},{"graph":{"nodes":[{"id":"272","labels":["EMAIL"],"properties":{"name":"EMAIL","document_id":"RITM100123"}},{"id":"283","labels":["Topic tags"],"properties":{"name":"topic_tag: Topic 2:  payment_bank"}},{"id":"285","labels":["Sentence"],"properties":{"name":"sentence: Our new bank details:-\r ., Account number: 09490002774, IFSC: IDID92999010, Bank Name: PPPWWWXXX."}}],"relationships":[{"id":"257","type":"CONTEXT","startNode":"283","endNode":"285","properties":{}},{"id":"255","type":"CONTAINS","startNode":"272","endNode":"283","properties":{}}]}},{"graph":{"nodes":[{"id":"272","labels":["EMAIL"],"properties":{"name":"EMAIL","document_id":"RITM100123"}},{"id":"283","labels":["Topic tags"],"properties":{"name":"topic_tag: Topic 2:  payment_bank"}},{"id":"285","labels":["Sentence"],"properties":{"name":"sentence: Our new bank details:-\r ., Account number: 09490002774, IFSC: IDID92999010, Bank Name: PPPWWWXXX."}},{"id":"286","labels":["RESOLUTION_BANK"],"properties":{"name":"RESOLUTION_BANK"}}],"relationships":[{"id":"257","type":"CONTEXT","startNode":"283","endNode":"285","properties":{}},{"id":"258","type":"CONTAINS","startNode":"285","endNode":"286","properties":{}},{"id":"255","type":"CONTAINS","startNode":"272","endNode":"283","properties":{}}]}},{"graph":{"nodes":[{"id":"272","labels":["EMAIL"],"properties":{"name":"EMAIL","document_id":"RITM100123"}},{"id":"283","labels":["Topic tags"],"properties":{"name":"topic_tag: Topic 2:  payment_bank"}},{"id":"285","labels":["Sentence"],"properties":{"name":"sentence: Our new bank details:-\r ., Account number: 09490002774, IFSC: IDID92999010, Bank Name: PPPWWWXXX."}},{"id":"286","labels":["RESOLUTION_BANK"],"properties":{"name":"RESOLUTION_BANK"}},{"id":"287","labels":["BANKDETAILSRESOLUTION"],"properties":{"name":"The bank details are updated"}}],"relationships":[{"id":"257","type":"CONTEXT","startNode":"283","endNode":"285","properties":{}},{"id":"258","type":"CONTAINS","startNode":"285","endNode":"286","properties":{}},{"id":"259","type":"RESOLUTION_STATUS","startNode":"286","endNode":"287","properties":{}},{"id":"255","type":"CONTAINS","startNode":"272","endNode":"283","properties":{}}]}}]}],"errors":[]};

    //###################################################################################################
    var nodeItemMap = [];
    var linkItemMap = []
    var neo4jDataItmArray = data.results[0].data;
    neo4jDataItmArray.forEach(function(dataItem) {
        //Node
        if (dataItem.graph.nodes != null && dataItem.graph.nodes.length > 0) {
        var neo4jNodeItmArray = dataItem.graph.nodes;
        neo4jNodeItmArray.forEach(function(nodeItm) {
            if (!(nodeItm.id in nodeItemMap))
            nodeItemMap[nodeItm.id] = nodeItm;
        });
        }
        //Link
        if (dataItem.graph.relationships != null && dataItem.graph.relationships.length > 0) {
        var neo4jLinkItmArray = dataItem.graph.relationships;
        neo4jLinkItmArray.forEach(function(linkItm) {
            if (!(linkItm.id in linkItemMap)) {
            linkItm.source = linkItm.startNode;
            linkItm.target = linkItm.endNode;
            linkItemMap[linkItm.id] = linkItm;
            }
        });
        }
    });

    // console.log(linkItemMap);
    // console.log(nodeItemMap);
    var nodes = Object.values(nodeItemMap);
    var links = Object.values(linkItemMap);
    </script>
</body>
</html>